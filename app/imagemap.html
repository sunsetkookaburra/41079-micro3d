<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Image Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""></script>
  <script src="https://geographiclib.sourceforge.io/scripts/geographiclib-geodesic.min.js"></script>
  <script src="./rig.js"></script>
  <!-- <script type="module" src="./micro3d.mjs"></script> -->
  <!-- <script type="module" src="../math.mjs"></script> -->
  <script src="../lib/exif-reader.js"></script>
  <style>
    .obj { filter: hue-rotate(150deg) }
  </style>
</head>
<body>
  <main>
    <!-- <p><label>ðŸ“¸ Select Images: <input type="file" multiple/></label></p> -->
    <article id="testing-rig" style="width: 600px; height: 500px;"></article>
    <output></output>
    <samp></samp>
  </main>
  <script type="module">
    import { captureParameters, angleTo, CAPTURE} from "../math.mjs";
    import { correlateDistances } from "./micro3d.mjs";
    const output = document.querySelector("output");
    const exampleRig = new TestingRig("testing-rig", () => {
      console.log(exampleRig.createCapture());
    });

    // output.innerText += `${JSON.stringify(CAPTURE, null, 2)}\n`;
    //output.innerText += `${JSON.stringify(correlateDistances(CAPTURE), null, 2)}\n`;
    //output.innerText += `${JSON.stringify(debug(), null, 2)}\n`;
    const [frameCoords,featureCoords] = correlateDistances(CAPTURE)
    //output.innerText += `${JSON.stringify(correlateDistances(CAPTURE), null, 2)}\n`;
    
    // window.addEventListener("load", async () => {
    //   const tags = await ExifReader.load(await (await fetch("../img/IMG_4289.jpg")).arrayBuffer());
    //   delete tags["MakerNote"];
    //   const samp = document.querySelector("samp");
    //   // samp.style.whiteSpace = "pre";
    //   // samp.innerText += JSON.stringify(tags, null, 2);
    //   const params = captureParameters(tags); 
    //   output.innerText += `${JSON.stringify(params, null, 2)}\n`;
    //   // samp.innerText += `${angleTo({x:1008,y:1512},params.frame,params.fov).x}\n`;
    //   // samp.innerText += "HFOV: " + ((2 * Math.atan(36 / 2 / tags["FocalLengthIn35mmFilm"]["value"]) * 180 / Math.PI)).toFixed(2);

    // });
    const FOV = 69.4;
    const CAM_TR = exampleRig.addCamera(frameCoords[0], { fov: FOV, heading: 15 });
    const CAM_BR = exampleRig.addCamera(frameCoords[1], { fov: FOV, heading: 100 });
    const CAM_BL = exampleRig.addCamera(frameCoords[2], { fov: FOV, heading: 200 });
    const CAM_TL = exampleRig.addCamera(frameCoords[3], { fov: FOV, heading: 250 });
    const CAM_TM = exampleRig.addCamera(frameCoords[4], { fov: FOV, heading: 280 });
    const OBJ_BAG = exampleRig.addFeature(featureCoords[0], { tags: { "description": "bag" } });
    const OBJ_BIN = exampleRig.addFeature(featureCoords[1], { tags: { "amenity": "waste_basket" } });
    const OBJ_TABLE = exampleRig.addFeature(featureCoords[2], { tags: { "amenity": "table" } });
    const OBJ_CHAIR = exampleRig.addFeature(featureCoords[3], { tags: { "amenity": "chair" } });
    const OBJ_PLANT = exampleRig.addFeature(featureCoords[4], { tags: { "man_made": "planter" } });
  </script>
</body>
</html>
